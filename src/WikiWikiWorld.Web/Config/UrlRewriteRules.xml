<?xml version="1.0" encoding="utf-8"?>
<rewrite>
	<rules>
		<clear />
		<rule enabled="true" stopProcessing="true">
			<match url="(.*)" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTPS}" pattern="^OFF$" />
			</conditions>
			<action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" appendQueryString="false" redirectType="308" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^info:sitemap$" />
			<action type="Rewrite" url="Sitemap" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^$" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTP_HOST}" pattern="^magazedia\.wiki$|^localhost(:[0-9]+)?$" />
			</conditions>
			<action type="Rewrite" url="https://{HTTP_HOST}/CultureSelect" />
		</rule>
		<rule enabled="true">
			<match url="(.*)" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTP_HOST}" pattern="^magazedia\.wiki$|^en\.magazedia\.wiki$|^xx-test\.magazedia\.wiki$|^ja\.magazedia\.wiki$|^ar\.magazedia\.wiki$|^localhost|^en\.localhost|^xx-test\.localhost|^ja\.localhost|^ar\.localhost|^crtr.world|^fanfare.wiki" negate="true" />
			</conditions>
			<action type="Redirect" url="https://en.magazedia.wiki/{R:1}" redirectType="308" />
		</rule>
		<rule enabled="true">
			<match url="^login:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Account/Login" />
		</rule>
		<rule enabled="true">
			<match url="^register:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Identity/Account/Register" />
		</rule>
		<rule enabled="true">
			<match url="^dmca:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Dmca" />
		</rule>
		<rule enabled="true">
			<match url="^privacy-policy:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Privacy" />
		</rule>
		<rule enabled="true">
			<match url="^terms:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Terms" />
		</rule>
		<rule enabled="true">
			<match url="^firehose:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/Firehose" />
		</rule>
		<rule enabled="true">
			<match url="^create:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/Create" />
		</rule>
		<rule enabled="true">
			<match url="^file:(.+)" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/View?UrlSlug=file:{R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/edit" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/Edit?UrlSlug={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/history$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/History?UrlSlug={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/talk$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/Talk?UrlSlug={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/revision/(.+)" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/View?UrlSlug={R:1}&amp;Revision={R:2}" appendQueryString="true" />
		</rule>
		<rule enabled="true">
			<match url="^404:(.+)" />
			<action type="Rewrite" url="https://{HTTP_HOST}/NotFound?UrlSlug={R:1}" />
		</rule>
		<rule name="Rewrite Rule">
			<match url="^(?!api/)(?!Privacy)(?!Terms)(?!NotFound)(?!Article/Create)(?!Dmca)(?!Sitemap)(?!sitemap.xml)(?!dev/CoverList)(?!Article/History)(?!Article/Firehose)(?!Article/Edit)(?!Article/Talk)(?!Article/View)(?!DbHelper)(?!Article/TalkSubject)(?!Account\/)(?!$)(?!.*\.(?:jpg|jpeg|gif|png|webp|avif|css|js|ico|txt|webmanifest)$)(.*)" />
			<action type="Rewrite" url="Article/View?UrlSlug={R:1}" appendQueryString="true" />
		</rule>
	</rules>
</rewrite>
