<?xml version="1.0" encoding="utf-8"?>
<rewrite>
	<rules>
		<clear />
		<rule enabled="true" stopProcessing="true">
			<match url="(.*)" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTPS}" pattern="^OFF$" />
			</conditions>
			<action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" appendQueryString="false" redirectType="308" />
		</rule>
		<!-- Redirect www.magazedia.com, magazedia.wiki, www.magazedia.wiki to magazedia.com -->
		<rule enabled="true" stopProcessing="true">
			<match url="(.*)" />
			<conditions logicalGrouping="MatchAny" trackAllCaptures="false">
				<add input="{HTTP_HOST}" pattern="^www\.magazedia\.com$" />
				<add input="{HTTP_HOST}" pattern="^magazedia\.wiki$" />
				<add input="{HTTP_HOST}" pattern="^www\.magazedia\.wiki$" />
			</conditions>
			<action type="Redirect" url="https://magazedia.com/{R:1}" redirectType="308" />
		</rule>
		<!-- Redirect static.magazedia.wiki to static.magazedia.com -->
		<rule enabled="true" stopProcessing="true">
			<match url="(.*)" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTP_HOST}" pattern="^static\.magazedia\.wiki$" />
			</conditions>
			<action type="Redirect" url="https://static.magazedia.com/{R:1}" redirectType="308" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^info:sitemap$" />
			<action type="Rewrite" url="Sitemap" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^$" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTP_HOST}" pattern="^magazedia\.com$|^localhost(:[0-9]+)?$" />
			</conditions>
			<action type="Rewrite" url="https://{HTTP_HOST}/CultureSelect" />
		</rule>
		<rule enabled="true">
			<match url="(.*)" />
			<conditions logicalGrouping="MatchAll" trackAllCaptures="false">
				<add input="{HTTP_HOST}" pattern="^magazedia\.com$|^en\.magazedia\.com$|^xx-test\.magazedia\.com$|^ja\.magazedia\.com$|^ar\.magazedia\.com$|^localhost|^en\.localhost|^xx-test\.localhost|^ja\.localhost|^ar\.localhost|^crtr.world|^fanfare.wiki" negate="true" />
			</conditions>
			<action type="Redirect" url="https://en.magazedia.com/{R:1}" redirectType="308" />
		</rule>
		<rule enabled="true">
			<match url="^login:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Account/Login" />
		</rule>
		<rule enabled="true">
			<match url="^register:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Account/Register" />
		</rule>
		<rule enabled="true">
			<match url="^dmca:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Dmca" />
		</rule>
		<rule enabled="true">
			<match url="^privacy-policy:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Privacy" />
		</rule>
		<rule enabled="true">
			<match url="^terms:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Terms" />
		</rule>
		<rule enabled="true">
			<match url="^settings/theme:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Settings/Theme" />
		</rule>
		<rule enabled="true">
			<match url="^firehose:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/Firehose" />
		</rule>
		<rule enabled="true">
			<match url="^create:" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/CreateEdit" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^@(.+)/profile$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Profile/View?Username={R:1}" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^@(.+)/contributions$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Profile/Contributions?Username={R:1}" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^@(.+)/messages$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Profile/Messages?Username={R:1}" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^@(.+)/messages/sent$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Profile/Messages?Username={R:1}&amp;Tab=sent" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^message/new$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Profile/NewMessage" />
		</rule>
		<rule enabled="true" stopProcessing="true">
			<match url="^@(.+)/message/new$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Profile/NewMessage?Recipient={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="^file:(.+)" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/View?UrlSlug=file:{R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/edit" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/CreateEdit?UrlSlug={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/history$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/History?UrlSlug={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/talk$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/Talk?UrlSlug={R:1}" />
		</rule>
		<rule enabled="true">
			<match url="(.+)/revision/(.+)" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/View?UrlSlug={R:1}&amp;Revision={R:2}" appendQueryString="true" />
		</rule>
		<rule enabled="true">
			<match url="^@(.+)/talk/(.+)$" />
			<action type="Rewrite" url="https://{HTTP_HOST}/Article/TalkSubject?UrlSlug={R:2}" />
		</rule>
		<rule enabled="true">
			<match url="^404:(.+)" />
			<action type="Rewrite" url="https://{HTTP_HOST}/NotFound?UrlSlug={R:1}" />
		</rule>
		<rule name="Rewrite Rule">
			<match url="^(?!api/)(?!Privacy)(?!Terms)(?!NotFound)(?!Article/CreateEdit)(?!Article/Delete)(?!Dmca)(?!Sitemap)(?!sitemap.xml)(?!dev/CoverList)(?!Article/History)(?!Article/Firehose)(?!Article/Talk)(?!Article/View)(?!DbHelper)(?!Article/TalkSubject)(?!Account\/)(?!Settings\/)(?!Profile\/)(?!$)(?!.*\.(?:jpg|jpeg|gif|png|webp|avif|css|js|ico|txt|webmanifest)$)(.*)" />
			<action type="Rewrite" url="Article/View?UrlSlug={R:1}" appendQueryString="true" />
		</rule>
	</rules>
</rewrite>
